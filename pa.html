<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PKT Flix</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background-color: #000;
      color: white;
      font-family: Arial, sans-serif;
      height: 100%;
      overflow-x: hidden;
    }

    body.light-mode {
      background-color: #fff;
      color: #000;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 20px;
      background-color: #111;
      position: sticky;
      top: 0;
      z-index: 999;
      flex-wrap: wrap;
    }

    body.light-mode header {
      background-color: #ddd;
    }

    .logo {
      font-size: 24px;
      font-weight: bold;
      color: #00abff;
    }

    #clock-container {
      text-align: right;
      font-size: 16px;
      min-width: 120px;
    }

    #date {
      font-size: 13px;
      margin-top: 3px;
      opacity: 0.7;
    }

    .video-container {
      position: relative;
      width: 100%;
      max-width: 800px;
      margin: 10px auto 0;
      transition: opacity 0.3s ease, transform 0.3s ease;
    }

    .video-container.hidden {
      opacity: 0;
      pointer-events: none;
      transform: scale(0.95);
    }

    #video-player {
      width: 100%;
      height: 45vh;
      max-height: 360px;
      border-radius: 8px;
      background: black;
    }

    .clappr-fullscreen-btn {
      position: absolute;
      top: 8px;
      right: 8px;
      z-index: 10;
      cursor: pointer;
      background: rgba(0,0,0,0.4);
      border-radius: 4px;
      padding: 5px;
      color: white;
      font-size: 18px;
    }

    .category-buttons {
      margin: 20px auto 10px;
      text-align: center;
    }

    .cat-btn {
      background-color: #222;
      color: white;
      border: 1px solid #444;
      padding: 10px 20px;
      margin: 5px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.2s ease-in-out;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .cat-btn:hover,
    .cat-btn.active {
      background-color: #444;
      transform: scale(1.05);
    }

    body.light-mode .cat-btn {
      background-color: #ddd;
      color: #000;
      border-color: #bbb;
    }

    #views {
      text-align: center;
      margin: 15px 0;
      font-size: 16px;
    }

    #search-bar {
      width: 90%;
      max-width: 500px;
      padding: 10px;
      margin: 10px auto;
      display: block;
      border-radius: 8px;
      border: none;
      font-size: 16px;
    }

    .channel-list {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 10px;
      padding: 10px;
      justify-items: center;
      max-height: 75vh;
      overflow-y: auto;
    }

    .channel-item {
      width: 100%;
      max-width: 150px;
      background-color: #111;
      padding: 10px;
      border-radius: 10px;
      text-align: center;
      color: white;
      cursor: pointer;
    }

    body.light-mode .channel-item {
      background-color: #f0f0f0;
      color: #000;
    }

    .channel-logo {
      width: 100%;
      height: 100px;
      object-fit: contain;
      border-radius: 5px;
    }

    .channel-name {
      margin-top: 5px;
      font-size: 14px;
      font-weight: bold;
    }

    .playing-label {
      color: #00ff00;
      font-size: 13px;
      margin-top: 5px;
    }

    #loader {
      display: none;
      text-align: center;
      padding: 20px;
      color: white;
    }

    .spinner {
      border: 6px solid #444;
      border-top: 6px solid #00abff;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: auto;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    #mini-player {
      position: fixed;
      bottom: 10px;
      right: 10px;
      width: 200px;
      height: 120px;
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(0,0,0,0.7);
      display: none;
      z-index: 9999;
      overflow: hidden;
      background: black;
    }

    #mini-player video {
      width: 100%;
      height: 100%;
      border-radius: 10px;
    }

    @media (max-width: 600px) {
      .channel-item {
        max-width: 45%;
      }
      #video-player {
        height: 200px;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="logo">PKT Flix</div>
    <div id="clock-container">
      <div id="clock">--:--:--</div>
      <div id="date">--/--/----</div>
    </div>
  </header>

  <div class="video-container">
    <div id="player"></div>
    <div class="clappr-fullscreen-btn" id="fullscreen-btn" title="Fullscreen"><i class="fas fa-expand"></i></div>
  </div>

  <div class="category-buttons">
    <button class="cat-btn" onclick="switchTab('sports', m3uLinks.sports)"><i class="fas fa-futbol"></i> Sports</button>
    <button class="cat-btn" onclick="switchTab('entertainment', m3uLinks.entertainment)"><i class="fas fa-film"></i> Entertainment</button>
    <button class="cat-btn" onclick="switchTab('news', m3uLinks.news)"><i class="fas fa-newspaper"></i> News</button>
    <button class="cat-btn" onclick="switchTab('music', m3uLinks.music)"><i class="fas fa-music"></i> Music</button>
    <button class="cat-btn" onclick="switchTab('religious', m3uLinks.religious)"><i class="fas fa-praying-hands"></i> Religious</button>
    <button class="cat-btn" onclick="switchTab('other', m3uLinks.other)"><i class="fas fa-ellipsis-h"></i> Other</button>
    <button class="cat-btn" onclick="toggleTheme()"><i class="fas fa-adjust"></i> Theme</button>
  </div>

  <div id="views">üëÅÔ∏è Views: <span id="view-count">0</span></div>
  <input type="text" id="search-bar" oninput="searchChannels()" placeholder="üîç Search Channels..." x-webkit-speech speech />
  <div id="loader"><div class="spinner"></div><p>Loading Channels...</p></div>
  <div class="channel-list" id="channel-list"></div>
  <div id="mini-player"><video muted></video></div>
  <script src="https://cdn.jsdelivr.net/npm/clappr@latest/dist/clappr.min.js"></script>
<script>
  // ‡¶ò‡ßú‡¶ø
  function updateClockAndDate() {
    const now = new Date();
    document.getElementById('clock').innerText = now.toLocaleTimeString();
    document.getElementById('date').innerText = now.toLocaleDateString();
  }
  setInterval(updateClockAndDate, 1000);
  updateClockAndDate();

  // ‡¶•‡¶ø‡¶Æ ‡¶ü‡¶ó‡¶≤
  function toggleTheme() {
    document.body.classList.toggle('light-mode');
    localStorage.setItem('theme', document.body.classList.contains('light-mode') ? 'light' : 'dark');
  }

  if (localStorage.getItem('theme') === 'light') {
    document.body.classList.add('light-mode');
  }

  // ‡¶≠‡¶ø‡¶â ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü
  let viewCount = localStorage.getItem('viewCount') || 0;
  viewCount++;
  localStorage.setItem('viewCount', viewCount);
  document.getElementById('view-count').innerText = viewCount;

  // ‡¶™‡ßç‡¶≤‡ßá‡ßü‡¶æ‡¶∞
  let player = new Clappr.Player({
    parentId: '#player',
    autoPlay: false,
    width: '100%',
    height: '45vh',
    mute: false,
    playbackNotSupportedMessage: "Sorry, your browser does not support this video.",
  });

  document.getElementById('fullscreen-btn').addEventListener('click', () => {
    if (!player.isFullscreen()) {
      player.enterFullscreen();
    } else {
      player.exitFullscreen();
    }
  });

  const videoContainer = document.querySelector('.video-container');
  const miniPlayer = document.getElementById('mini-player');
  const miniPlayerVideo = miniPlayer.querySelector('video');
  let isMini = false;
  let lastScrollY = window.scrollY;

  window.addEventListener('scroll', () => {
    const goingDown = window.scrollY > lastScrollY;
    lastScrollY = window.scrollY;

    if (window.scrollY < 100) {
      videoContainer.classList.add('hidden');
      miniPlayer.style.display = 'none';
      miniPlayerVideo.pause();
      isMini = false;
    } else if (goingDown && player.isPlaying()) {
      videoContainer.classList.remove('hidden');
      if (!isMini) {
        miniPlayer.style.display = 'block';
        const src = player.getCurrentPlayback().getSrc();
        miniPlayerVideo.src = src;
        miniPlayerVideo.play();
        isMini = true;
      }
    }
  });

  const m3uLinks = {
    sports: 'https://iptv-org.github.io/iptv/categories/sports.m3u',
    entertainment: 'https://iptv-org.github.io/iptv/categories/entertainment.m3u',
    news: 'https://iptv-org.github.io/iptv/categories/news.m3u',
    music: 'https://iptv-org.github.io/iptv/categories/music.m3u',
    religious: 'https://iptv-org.github.io/iptv/categories/religious.m3u',
    other: 'https://iptv-org.github.io/iptv/categories/others.m3u'
  };

  let channels = [];
  let currentTab = 'sports';
  let playingChannel = '';

  function loadM3UData(m3uLink) {
    document.getElementById('loader').style.display = 'block';
    fetch(m3uLink)
      .then(res => res.text())
      .then(data => {
        channels = [];
        parseM3UData(data);
        displayChannels();
        document.getElementById('loader').style.display = 'none';
      })
      .catch(err => {
        console.error(err);
        document.getElementById('loader').style.display = 'none';
      });
  }

  function parseM3UData(data) {
    const lines = data.split('\n');
    for (let i = 0; i < lines.length; i++) {
      if (lines[i].startsWith('#EXTINF')) {
        let name = lines[i].split(',')[1]?.trim() || 'Unknown';
        let logoMatch = lines[i].match(/tvg-logo="(.*?)"/);
        let logo = logoMatch ? logoMatch[1] : 'https://via.placeholder.com/100';
        let link = lines[i + 1]?.trim();
        if (link && link.startsWith('http')) {
          channels.push({ name, logo, m3uLink: link });
        }
      }
    }
  }

  function displayChannels() {
    const list = document.getElementById('channel-list');
    list.innerHTML = '';
    channels.forEach(channel => {
      const div = document.createElement('div');
      div.className = 'channel-item';
      div.innerHTML = `
        <img src="${channel.logo}" class="channel-logo" onclick="playVideo('${channel.m3uLink}')" />
        <div class="channel-name">${channel.name}</div>
        <div class="playing-label" style="display: ${playingChannel === channel.m3uLink ? 'block' : 'none'};"><i class='fas fa-play'></i> Playing</div>
      `;
      list.appendChild(div);
    });
  }

  function playVideo(m3uLink) {
    playingChannel = m3uLink;
    localStorage.setItem('lastPlayed', m3uLink);
    player.load(m3uLink);
    player.play();
    displayChannels();
  }

  function switchTab(tab, m3uLink) {
    currentTab = tab;
    playingChannel = '';
    loadM3UData(m3uLink);
  }

  function searchChannels() {
    const q = document.getElementById('search-bar').value.toLowerCase();
    const filtered = channels.filter(c => c.name.toLowerCase().includes(q));
    const list = document.getElementById('channel-list');
    list.innerHTML = '';
    filtered.forEach(channel => {
      const div = document.createElement('div');
      div.className = 'channel-item';
      div.innerHTML = `
        <img src="${channel.logo}" class="channel-logo" onclick="playVideo('${channel.m3uLink}')" />
        <div class="channel-name">${channel.name}</div>
        <div class="playing-label" style="display: ${playingChannel === channel.m3uLink ? 'block' : 'none'};"><i class='fas fa-play'></i> Playing</div>
      `;
      list.appendChild(div);
    });
  }

  window.addEventListener('DOMContentLoaded', () => {
    const last = localStorage.getItem('lastPlayed');
    if (last) {
      playingChannel = last;
      player.load(last);
    }
    switchTab(currentTab, m3uLinks[currentTab]);
  });
</script>
</body>
</html>
